---
title: "Supported LaTeX commands"
author: "Stefano Meschiari"
date: "`r Sys.Date()`"
---

```{r, plot-commands-for-readme, results='asis', echo=FALSE}
# This file is used by ../README.Rmd to create a table of commands that
# can be rendered by Github Flavored Markdown.

library(latex2exp)
library(htmltools)

counters <- list()

# create an <img> tag for each LaTeX command by plotting the example to a JPEG
# image, then embedding the image.
make_img <- function(g, category, ..., style="") {
  counters[[category]] <<- if (is.null(counters[[category]])) {
    1
  } else {
    counters[[category]] + 1
  }
  path <- file.path("commands", category)
  if (!dir.exists(path)) {
    dir.create(path, recursive = TRUE)
  }
  filename <- file.path(path,
                        str_c(counters[[category]], ".jpg"))
  
  jpeg(filename, ...)  
  force(g)
  dev.off() 
  
  # Resize to ensure the output is small
  system(sprintf("/opt/homebrew/bin/mogrify -resize 200 '%s'", filename))
  myImage <- htmltools::img(src=file.path("markdown", filename), style=style)
  return(myImage)
}

supported <- latex2exp_supported()

supported$category <- str_to_title(supported$category)
supported <- supported %>% filter(!is.na(example))
supported$command <- supported$example

rows <- pmap(supported, function(category, command, example) {
  img <- make_img(plot(TeX(example), cex=4.25, main=""), category,
                  width=400, height=150)
  htmltools::tags$tr(
    htmltools::tags$td(category),
    htmltools::tags$td(htmltools::tags$pre(str_c("TeX(r\"(", command, ")\")"))),
    htmltools::tags$td(img)
  )
})

htmltools::tags$table(
  htmltools::tags$thead(
    htmltools::tags$tr(
      htmltools::tags$th("Category"),
      htmltools::tags$th("LaTeX command"),
      htmltools::tags$th("Example")
    ),
  ),
  htmltools::tags$tbody(rows)
)
```
